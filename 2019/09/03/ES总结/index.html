<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="ElasticSearch 总结"/>




  <meta name="keywords" content="ElasticSearch, 中间件, Corn1ng's Blog" />










  <link rel="alternate" href="/default" title="Corn1ng's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://corn1ng.github.io/2019/09/03/ES总结/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> ElasticSearch 总结 - Corn1ng's Blog </title>\
    <style type="text/css">
    .content-wrapper:{top:200px;}
    .footer:{top:200px;}
    </style>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Corn1ng's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            About
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Corn1ng's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              Tags
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              Categories
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              About
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>
      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          ElasticSearch 总结
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-09-03
        </span>
        
          <div class="post-category">
            
              <a href="/categories/中间件/">中间件</a>
            
          </div>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ES"><span class="toc-text">ES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#相关概念"><span class="toc-text">相关概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引常用操作"><span class="toc-text">索引常用操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#映射常见操作"><span class="toc-text">映射常见操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态映射"><span class="toc-text">动态映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析器Analyzer"><span class="toc-text">分析器Analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文档管理"><span class="toc-text">文档管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#搜索"><span class="toc-text">搜索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#特殊的搜索方法"><span class="toc-text">特殊的搜索方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Request-body-Search"><span class="toc-text">Request body Search</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#聚合分析"><span class="toc-text">聚合分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#桶聚合"><span class="toc-text">桶聚合</span></a></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <h3 id="ES"><a href="#ES" class="headerlink" title="ES"></a>ES</h3><h4 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h4><ul>
<li><strong>Near Realtime（NRT） 近实时</strong>。数据提交索引后，立马就可以搜索到。<br><strong>Cluster 集群</strong>，一个集群由一个唯一的名字标识，默认为“elasticsearch”。集群名称非常重要，<strong>具有相同集群名的节点才会组成一个集群</strong>。集群名称可以在配置文件中指定。</li>
<li><strong>Node 节点</strong>：存储集群的数据，参与集群的索引和搜索功能。像集群有名字，节点也有自己的名称，默认在启动时会以一个随机的UUID的前七个字符作为节点的名字，你可以为其指定任意的名字。通过集群名在网络中发现同伴组成集群。一个节点也可是集群。</li>
<li><strong>Index 索引</strong>: 一个索引是一个文档的集合（等同于solr中的集合）。每个索引有唯一的名字，通过这个名字来操作它。一个集群中可以有任意多个索引。</li>
<li><strong>Type 类型</strong>：指在一个索引中，可以索引不同类型的文档，如用户数据、博客数据。从6.0.0 版本起已废弃，一个索引中只存放一类数据。</li>
<li><strong>Document 文档</strong>：被索引的一条数据，索引的基本信息单元，以JSON格式来表示。</li>
<li><strong>Shard 分片</strong>：在创建一个索引时可以指定分成多少个分片来存储。每个分片本身也是一个功能完善且独立的“索引”，可以被放置在集群的任意节点上。分片的好处：允许我们水平切分/扩展容量。可在多个分片上进行分布式的、并行的操作，提高系统的性能和吞吐量。</li>
</ul>
<p><strong>注意：分片数创建索引时指定，创建后不可改了。备份数可以随时改。</strong></p>
<ul>
<li><strong>Replication 备份:</strong> 一个分片可以有多个备份（副本）。备份的好处：高可用。<strong>一个主分片挂了，副本分片就顶上去</strong>。扩展搜索的并发能力、吞吐量。搜索可以在所有的副本上并行运行。-<strong>高并发下副本也可搜索</strong></li>
</ul>
<h4 id="索引常用操作"><a href="#索引常用操作" class="headerlink" title="索引常用操作"></a>索引常用操作</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//创建索引(在ES中创建一个索引类似于在数据库中建立一个数据库(ES6.0之后类似于创建一个表))</span><br><span class="line">PUT twitter</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"settings"</span> : &#123;</span><br><span class="line">        <span class="attr">"index"</span> : &#123;</span><br><span class="line">            <span class="attr">"number_of_shards"</span> : <span class="number">3</span>, </span><br><span class="line">            <span class="attr">"number_of_replicas"</span> : <span class="number">2</span> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//默认的分片数是5到1024</span><br><span class="line">//默认的备份数是1</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//创建mapping映射</span><br><span class="line">//在ES中创建一个mapping映射类似于在数据库中定义表结构，即表里面有哪些字段、字段是什么类型、字段的默认值等</span><br><span class="line">PUT twitter</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"settings"</span> : &#123;</span><br><span class="line">        <span class="attr">"index"</span> : &#123;</span><br><span class="line">            <span class="attr">"number_of_shards"</span> : <span class="number">3</span>, </span><br><span class="line">            <span class="attr">"number_of_replicas"</span> : <span class="number">2</span> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">   <span class="attr">"mappings"</span> : &#123;</span><br><span class="line">        <span class="attr">"type1"</span> : &#123;</span><br><span class="line">            <span class="attr">"properties"</span> : &#123;</span><br><span class="line">                <span class="attr">"field1"</span> : &#123; <span class="attr">"type"</span> : <span class="string">"text"</span> &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// type1 指的是type。 field1指的是字段名。text是字段类型。</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//查看索引的定义信息</span><br><span class="line">GET /twitter</span><br><span class="line">//查看所有索引的定义信息</span><br><span class="line">GET /_all</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//删除索引</span><br><span class="line">DELETE /twitter</span><br><span class="line">// 删除所有索引</span><br><span class="line">DELETE /_all</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//判断索引是否存在</span><br><span class="line">HEAD twitter</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//索引监控</span><br><span class="line">GET /_stats</span><br><span class="line">//查看指定索引的状态信息</span><br><span class="line">GET /index1,index2/_stats</span><br></pre></td></tr></table></figure>
<h4 id="映射常见操作"><a href="#映射常见操作" class="headerlink" title="映射常见操作"></a>映射常见操作</h4><p>映射定义索引中有什么字段、字段的类型等结构信息。<strong>相当于数据库中表结构定义，或 solr中的schema</strong>。因为lucene索引文档时需要知道该如何来索引存储文档的字段。ES中支持手动定义映射，动态映射两种方式。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//为索引test创建mapping</span><br><span class="line">PUT test</span><br><span class="line">&#123;</span><br><span class="line">//映射定义</span><br><span class="line">"mappings" : &#123;</span><br><span class="line">//名为type1的映射类别(mapping type)</span><br><span class="line">        "type1" : &#123;</span><br><span class="line">        //字段定义</span><br><span class="line">            "properties" : &#123;</span><br><span class="line">            //名为field1的字段，它的field datatype 为 text</span><br><span class="line">                "field1" : &#123; "type" : "text" &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//映射类别的废除说明</span><br><span class="line">//为了与之后的版本匹配，现在将这个唯一的映射类别名定义为“_doc”,因为索引的请求地址将规范为：PUT &#123;index&#125;/_doc/&#123;id&#125; and POST &#123;index&#125;/_doc</span><br><span class="line">因此改为了</span><br><span class="line">PUT twitter</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    "_doc": &#123; //////////////// type 改为 _doc</span><br><span class="line">      "properties": &#123;</span><br><span class="line">        "type": &#123; "type": "keyword" &#125;, </span><br><span class="line">        "name": &#123; "type": "text" &#125;,</span><br><span class="line">        "user_name": &#123; "type": "keyword" &#125;,</span><br><span class="line">        "email": &#123; "type": "keyword" &#125;,</span><br><span class="line">        "content": &#123; "type": "text" &#125;,</span><br><span class="line">        "tweeted_at": &#123; "type": "date" &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="动态映射"><a href="#动态映射" class="headerlink" title="动态映射"></a>动态映射</h4><p>动态映射是ES中提供的重要特性，让我们可以快速使用ES，而不需要先创建索引、定义映射。 如我们直接向ES提交文档进行索引。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PUT data/_doc/1 </span><br><span class="line">&#123; <span class="attr">"count"</span>: <span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>ES将自动为我们创建data索引、_doc 映射、类型为 long 的字段 count</strong></p>
<p>索引文档时，当有新字段时， ES将根据我们字段的json的数据类型为我们自动加人字段定义到mapping中。</p>
<h4 id="分析器Analyzer"><a href="#分析器Analyzer" class="headerlink" title="分析器Analyzer"></a>分析器Analyzer</h4><p>在ES中一个分析器由以下三种组件组合而成。</p>
<p><strong>character filter ：</strong>字符过滤器，对文本进行字符过滤处理，如处理文本中的html标签字符。处理完后再交给tokenizer进行分词。<strong>一个analyzer中可包含0个或多个字符过滤器，多个按配置顺序依次进行处理</strong>。<br><strong>tokenizer：</strong>分词器，对文本进行分词。<strong>一个analyzer必需且只可包含一个tokenizer</strong>。<br><strong>token filter：</strong>词项过滤器，对tokenizer分出的词进行过滤处理。如转小写、停用词处理、同义词处理。<strong>一个analyzer可包含0个或多个词项过滤器，按配置顺序进行过滤</strong>。</p>
<h4 id="文档管理"><a href="#文档管理" class="headerlink" title="文档管理"></a>文档管理</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//指定文档id，新增、修改</span><br><span class="line">PUT twitter/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"user"</span> : <span class="string">"kimchy"</span>,</span><br><span class="line">    <span class="attr">"post_date"</span> : <span class="string">"2009-11-15T14:12:12"</span>,</span><br><span class="line">    <span class="attr">"message"</span> : <span class="string">"trying out Elasticsearch"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//新增，自动生成文档id</span><br><span class="line">POST twitter/_doc/</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"user"</span> : <span class="string">"kimchy"</span>,</span><br><span class="line">    <span class="attr">"post_date"</span> : <span class="string">"2009-11-15T14:12:12"</span>,</span><br><span class="line">    <span class="attr">"message"</span> : <span class="string">"trying out Elasticsearch"</span></span><br><span class="line">&#125;</span><br><span class="line">------------</span><br><span class="line">//  返回结果</span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "twitter",   // 所属索引</span><br><span class="line">  "_type" : "_doc",       //所属mapping type</span><br><span class="line">  "_id" : "ec5B9mwB-bWstPBClp9t",   //文档id</span><br><span class="line">  "_version" : 1,         // 文档版本</span><br><span class="line">  "result" : "created",   </span><br><span class="line">  "_shards" : &#123;            // 分片的写入情况</span><br><span class="line">    "total" : 3,           //所在分片有三个副本</span><br><span class="line">    "successful" : 1,      // 1个副本上成功写入</span><br><span class="line">    "failed" : 0           // 失败副本数</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 0,           // 第几次操作该文档</span><br><span class="line">  "_primary_term" : 1      // 词项数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//获取单个文档</span><br><span class="line">HEAD twitter/_doc/11</span><br><span class="line">GET twitter/_doc/1</span><br><span class="line">不获取文档的source：</span><br><span class="line">GET twitter/_doc/1?_source=false</span><br><span class="line">获取文档的source：</span><br><span class="line">GET twitter/_doc/1/_source</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//删除文档</span><br><span class="line">指定文档id进行删除</span><br><span class="line">DELETE twitter/_doc/1</span><br><span class="line"> 用版本来控制删除</span><br><span class="line">DELETE twitter/_doc/1?version=1</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//更新文档</span><br><span class="line">// 指定文档id进行修改</span><br><span class="line">PUT twitter/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"user"</span> : <span class="string">"kimchy"</span>,</span><br><span class="line">    <span class="attr">"post_date"</span> : <span class="string">"2009-11-15T14:12:12"</span>,</span><br><span class="line">    <span class="attr">"message"</span> : <span class="string">"trying out Elasticsearch"</span></span><br><span class="line">&#125;</span><br><span class="line">----------------乐观锁并发更新控制</span><br><span class="line">PUT twitter/_doc/1?version=1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"user"</span> : <span class="string">"kimchy"</span>,</span><br><span class="line">    <span class="attr">"post_date"</span> : <span class="string">"2009-11-15T14:12:12"</span>,</span><br><span class="line">    <span class="attr">"message"</span> : <span class="string">"trying out Elasticsearch"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//从索引tweet里面搜索字段user为k的记录</span><br><span class="line"> GET /twitter/_search?q=user:k</span><br><span class="line">//从索引tweet,user里面搜索字段user为k的记录</span><br><span class="line">GET /tweet,user/_search?q=user:k</span><br><span class="line">//从所有索引里面搜索字段tag 为wow的记录</span><br><span class="line">GET /_all/_search?q=tag:wow</span><br><span class="line">GET /_search?q=tag:wow</span><br></pre></td></tr></table></figure>
<h4 id="特殊的搜索方法"><a href="#特殊的搜索方法" class="headerlink" title="特殊的搜索方法"></a>特殊的搜索方法</h4><p>如果我们只想知道有多少文档匹配某个查询，可以这样用参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search?q=city:b*&amp;size=0</span><br></pre></td></tr></table></figure>
<p>如果我们只想知道有没有文档匹配某个查询，可以这样用参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search?q=city:b*&amp;size=0&amp;terminate_after=1</span><br></pre></td></tr></table></figure>
<h4 id="Request-body-Search"><a href="#Request-body-Search" class="headerlink" title="Request body Search"></a>Request body Search</h4><p>Request body 搜索方式以JSON格式在请求体中定义查询 query。请求方式可以是 GET 、POST 。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /twitter/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--------</span><br><span class="line">可用的参数:</span><br><span class="line">query: 用Query DSL来定义查询</span><br><span class="line">timeout：请求超时时长，限定在指定时长内响应（即使没查完）；</span><br><span class="line">from： 分页的起始行，默认0；</span><br><span class="line">size：分页大小；</span><br><span class="line">request_cache：是否缓存请求结果，默认true。</span><br><span class="line">terminate_after：限定每个分片取几个文档。如果设置，则响应将有一个布尔型字段terminated_early来指示查询执行是否实际已经terminate_early。缺省为no terminate_after；</span><br><span class="line">search_type：查询的执行方式，可选值dfs_query_then_fetch or query_then_fetch ，默认： query_then_fetch ；</span><br><span class="line">batched_reduce_size：一次在协调节点上应该减少的分片结果的数量。如果请求中的潜在分片数量可能很大，则应将此值用作保护机制以减少每个搜索请求的内存开销。</span><br></pre></td></tr></table></figure>
<h4 id="聚合分析"><a href="#聚合分析" class="headerlink" title="聚合分析"></a>聚合分析</h4><p>聚合分析是数据库中重要的功能特性，完成对一个查询的数据集中数据的聚合计算，如：找出某字段（或计算表达式的结果）的最大值、最小值，计算和、平均值等。ES作为搜索引擎兼数据库，同样提供了强大的聚合分析能力。对一个数据集求最大、最小、和、平均值等指标的聚合，在ES中称为<strong>指标聚合   metric</strong>。而关系型数据库中除了有聚合函数外，还可以对查询出的数据进行分组group by，再在组上进行指标聚合。在 ES 中group by 称为<strong>分桶</strong>，<strong>桶聚合 bucketing</strong>。ES中还提供了矩阵聚合（matrix）、管道聚合（pipleline），但还在完善中。</p>
<p>聚合的写法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"aggregations" : &#123;</span><br><span class="line">    "&lt;aggregation_name&gt;" : &#123; &lt;!--聚合的名字 --&gt;</span><br><span class="line">        "&lt;aggregation_type&gt;" : &#123; &lt;!--聚合的类型 --&gt;</span><br><span class="line">            &lt;aggregation_body&gt; &lt;!--聚合体：对哪些字段进行聚合 --&gt;</span><br><span class="line">        &#125;</span><br><span class="line">        [,"meta" : &#123;  [&lt;meta_data_body&gt;] &#125; ]? &lt;!--元 --&gt;</span><br><span class="line">        [,"aggregations" : &#123; [&lt;sub_aggregation&gt;]+ &#125; ]? &lt;!--在聚合里面在定义子聚合 --&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    [,"&lt;aggregation_name_2&gt;" : &#123; ... &#125; ]*&lt;!--聚合的名字 --&gt;</span><br><span class="line">&#125;</span><br><span class="line">//聚合计算的值可以取字段的值，也可是脚本计算的结果。</span><br><span class="line">// aggregations 可以简写为aggs</span><br></pre></td></tr></table></figure>
<ul>
<li>Max min sum avg </li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//查询所有客户中余额的最大值</span><br><span class="line">POST /bank/_search?</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">0</span>, </span><br><span class="line">  "aggs": &#123;            //   !!!!!!!!!!!</span><br><span class="line">    "masssbalance": &#123;  //!!!!!!!!!!!!!!</span><br><span class="line">      "max": &#123;         //   !!!!!!!!!!!!!</span><br><span class="line">        "field": "balance"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">2080</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"hits"</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  "aggregations": &#123;      //!!!!!!!!!!!!!!!!</span><br><span class="line">    "masssbalance": &#123;    //!!!!!!!!!!!!!!!！</span><br><span class="line">      "value": 49989     //!!!!!!!!!!!!!!!!</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// 查询年龄为21岁的客户中的余额最大值</span><br><span class="line">POST /bank/_search?</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">2</span>, </span><br><span class="line">  "query": &#123;      //!!!!!!!!!!!!!!</span><br><span class="line">    "match": &#123;    //!!!!!!!!!!!!!!</span><br><span class="line">      "age": 24   //!!!!!!!!!!!!!</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  "sort": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"balance"</span>: &#123;</span><br><span class="line">        <span class="attr">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "aggs": &#123;</span><br><span class="line">    "max_balance": &#123;</span><br><span class="line">      "max": &#123;    //!!!!!!!!!!!!!!!!</span><br><span class="line">        "field": "balance"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">---------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="literal">null</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  "aggregations": &#123;          //!!!!!!!!!!!!!!</span><br><span class="line">    "max_balance": &#123;         //!!!!!!!!!!!!!!</span><br><span class="line">      "value": 48745         //!!!!!!!!!!!!!!</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>文档计数count</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//统计银行索引bank下年龄为24的文档数量</span><br><span class="line">POST /bank/_doc/_count</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match"</span>: &#123;</span><br><span class="line">      <span class="attr">"age"</span> : <span class="number">24</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"count"</span>: <span class="number">42</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="桶聚合"><a href="#桶聚合" class="headerlink" title="桶聚合"></a>桶聚合</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">//根据项分组计数(根据工资进行统计)</span><br><span class="line">POST /customer/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">0</span>, </span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"group_count"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;<span class="attr">"field"</span>: <span class="string">"salary"</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">----------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"took"</span>: <span class="number">26</span>,</span><br><span class="line">    <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"hits"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">"max_score"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"hits"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"aggregations"</span>: &#123;</span><br><span class="line">        <span class="attr">"group_count"</span>: &#123;</span><br><span class="line">            <span class="attr">"doc_count_error_upper_bound"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"sum_other_doc_count"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"buckets"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">15000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">2</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">20000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">2</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">17000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">1</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">18000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">//分组基础上再统计</span><br><span class="line">POST /customer/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">0</span>, </span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"group_count"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;<span class="attr">"field"</span>: <span class="string">"salary"</span>&#125;,</span><br><span class="line">      <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">        <span class="attr">"avg_age"</span>:&#123;</span><br><span class="line">          <span class="attr">"avg"</span>:&#123;<span class="attr">"field"</span>: <span class="string">"age"</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"took"</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"hits"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">"max_score"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"hits"</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"aggregations"</span>: &#123;</span><br><span class="line">        <span class="attr">"group_count"</span>: &#123;</span><br><span class="line">            <span class="attr">"doc_count_error_upper_bound"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"sum_other_doc_count"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"buckets"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">15000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">2</span>,</span><br><span class="line">                    <span class="attr">"avg_age"</span>: &#123;</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">26.5</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">20000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">2</span>,</span><br><span class="line">                    <span class="attr">"avg_age"</span>: &#123;</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">30.5</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">17000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="attr">"avg_age"</span>: &#123;</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">26</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"key"</span>: <span class="number">18000</span>,</span><br><span class="line">                    <span class="attr">"doc_count"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="attr">"avg_age"</span>: &#123;</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">27</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <a href="https://corn1ng.github.io">corn1ng</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="https://corn1ng.github.io/2019/09/03/ES总结/">https://corn1ng.github.io/2019/09/03/ES总结/</a>
    </p>
    <p class="copyright-item">
      <span>License: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/ElasticSearch/">ElasticSearch</a>
            
              <a href="/tags/中间件/">中间件</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2019/08/05/fastJSON 速览/">
        <span class="next-text nav-default">fastJSON</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:wangkangning1@foxmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="http://github.com/corn1ng" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://www.instagram.com/brett0427/" class="iconfont icon-instagram" title="instagram"></a>
        
      
    
    
    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  

  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">corn1ng</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

    
    <script type="text/javascript"
    color="0,0,255" opacity='0.99' zIndex="-2" count="100" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
    
  </body>
</html>
